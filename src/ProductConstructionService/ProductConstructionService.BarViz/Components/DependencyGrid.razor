@using ProductConstructionService.BarViz.Code.Helpers
@using ProductConstructionService.Client.Models;

@if (_buildGraphData == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <FluentStack VerticalGap="10" Orientation="Orientation.Vertical">

        <FluentStack Orientation="Orientation.Horizontal">
            <FluentLabel Typo="Typography.H3">Dependencies</FluentLabel>
            <FluentStack HorizontalAlignment="HorizontalAlignment.Right">
                <FluentSwitch Style="float: right;" @bind-Value="IncludeReleasedBuilds">Include Released Builds</FluentSwitch>
                <FluentSwitch Style="float: right;" @bind-Value="ShowSubDependencies">Show Sub-Dependencies</FluentSwitch>
                <FluentSwitch Style="float: right;" @bind-Value="IncludeToolset">Include Toolsets</FluentSwitch>
            </FluentStack>
        </FluentStack>

        <FluentDataGrid Id="dependencyGrid" Items="@_dependenciesGridData" TGridItem=BuildDependenciesGridRow Style="width: 100%">
            <TemplateColumn Title="Repository" SortBy="repositoryName" Sortable="true" Align="Align.Start">
                <a href="@(context.LinkToBuildDetails ?? "javascript:void(0)")">@context.RepositoryName</a>
            </TemplateColumn>
            <PropertyColumn Title="Commit" Property="@(r => r.CommitShort)" Align="Align.Start" Width="8rem" />
            <PropertyColumn Title="Age" Property="@(r => r.AgeDays)" Sortable="true" Align="Align.End" Width="5rem" />
            <PropertyColumn Title="Staleness" Property="@(r => r.BuildStaleness)" Align="Align.Start" Width="8rem" />
            <TemplateColumn Sortable="false" Align="Align.Start" Title="Build Number" Width="8rem">
                <a href="@context.BuildUrl" target="_blank">
                    <FluentBadge Appearance="Appearance.Accent">@context.BuildNumber</FluentBadge>
                </a>
            </TemplateColumn>
        </FluentDataGrid>
    </FluentStack>
}

@code {
    GridSort<BuildDependenciesGridRow> repositoryName = GridSort<BuildDependenciesGridRow>
            .ByAscending(x => x.RepositoryName);
}
