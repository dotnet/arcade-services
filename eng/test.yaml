steps: 

- task: VSTest@2
  inputs:
    searchFolder: $(Build.SourcesDirectory)/artifacts/bin
    testSelector: '**.\*.Tests.dll'
    testFiltercriteria: Category!=ScenarioTest
    codeCoverageEnabled: true
    configuration: $(_BuildConfig)

- script: echo export const token = ''; > src/environments/token.ts
  workingDirectory: $(Build.SourcesDirectory)/src/Maestro/maestro-angular
  displayName: Prepare For UI Tests

- script: npm run-script test -- --watch=false --reporters progress,junit --browsers ChromeHeadless
  workingDirectory: $(Build.SourcesDirectory)/src/Maestro/maestro-angular
  displayName: Run UI Tests

- task: PublishTestResults@2
  displayName: Publish UI Test Results
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '**/TESTS-*.xml' 
    searchFolder: $(Build.SourcesDirectory)/src/Maestro/maestro-angular
    testRunTitle: UI Tests ($(Agent.JobName))
